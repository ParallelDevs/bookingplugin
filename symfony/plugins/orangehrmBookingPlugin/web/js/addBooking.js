function fillProjectSelect(e,t){var a=$(e);a.find("option").remove(),$("<option>").val("").text("").appendTo(a),$.each(t,function(e,t){$("<option>").val(t.projectId).text(t.name).appendTo(a)})}function customerChangeHandler(){var e=$(this).val();""!==e&&$.ajax({type:"POST",url:customerProjectUrl,data:{customerId:e},cache:!1,success:function(e){fillProjectSelect("#projectId",e)}})}function startDateChangeHandler(e,t){var a=$(e).val();""===$(t).val()&&$(t).val(a)}function initDateField(e){jQuery(e).datetimepicker({timepicker:!1,format:"Y-m-d",formatDate:"Y-m-d",dayOfWeekStart:firstDayOfWeek})}function lockForm(){$("#startDate").attr("disabled","disabled"),$("#endDate").attr("disabled","disabled"),$("#startTime").attr("disabled","disabled"),$("#endTime").attr("disabled","disabled"),$("#hours").attr("disabled","disabled"),$("#minutes").attr("disabled","disabled"),$("#customerId").attr("disabled","disabled"),$("#projectId").attr("disabled","disabled")}function unlockForm(){$("#startDate").removeAttr("disabled"),$("#endDate").removeAttr("disabled"),$("#startTime").removeAttr("disabled"),$("#endTime").removeAttr("disabled"),$("#hours").removeAttr("disabled"),$("#minutes").removeAttr("disabled"),$("#customerId").removeAttr("disabled"),$("#projectId").removeAttr("disabled")}function setBookableWorkShift(e){var t=moment(e.minTime,"H:m"),a=moment(e.maxTime,"H:m");jQuery("#minStartTime").val(t.format("HH:mm:ss")),jQuery("#maxEndTime").val(a.format("HH:mm:ss")),a.add(15,"minutes"),jQuery("#startTime").datetimepicker({minTime:t.toDate(),maxTime:a.toDate()}),jQuery("#endTime").datetimepicker({minTime:t.toDate(),maxTime:a.toDate()})}function ajaxSaveBooking(){$.ajax({type:"POST",url:saveBookingUrl,data:$(".form-booking-plugin").serialize(),cache:!1,success:successBookingForm,dataType:"json"})}function successBookingForm(e){if(e.success)$(location).attr("href",viewBookingsUrl);else{$(".form-booking-plugin").find(".validation-error").remove(),$(".form-booking-plugin").find(".error-field").removeClass("error-field");for(var t=e.errors.length,a=0;a<t;a++){var r=$("#"+e.errors[a].field);$("<span>").addClass("validation-error").addClass(e.errors[a].field).attr("generated","true").text(e.errors[a].message).insertAfter(r),r.addClass("error-field")}}}jQuery(document).ready(function(){$("#bookableId").change(function(){var e=$(this).val();""!==e&&$.ajax({type:"POST",url:bookableWorkShiftsUrl,data:{bookableId:e},cache:!1,success:function(e){unlockForm(),setBookableWorkShift(e)}})}),$("#customerId").change(customerChangeHandler),$("#startDate").change(function(){startDateChangeHandler("#startDate","#endDate")}),initDateField("#startDate"),initDateField("#endDate"),$("#btnSave").click(function(){ajaxSaveBooking()}),""!==$("#bookableId").val()?$("#bookableId").change():lockForm(),""!==$("#customerId").val()&&$("#customerId").change()});